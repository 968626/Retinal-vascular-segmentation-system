# 视网膜血管分割系统 - 详细说明文档
# 源码获取：https://mbd.pub/o/bread/YZWXlp5saA== 
## 📖 项目概述

视网膜血管分割系统是一个基于深度学习UNet架构的医学图像分析工具，专门用于从视网膜图像中自动分割和识别血管结构。本项目采用DRIVE数据集进行训练和验证，提供了完整的端到端解决方案。

## 🎯 项目特性

### 核心功能
- **自动血管分割**: 使用预训练的UNet模型准确识别视网膜血管
- **多格式支持**: 支持PNG、JPG、JPEG、TIF、TIFF等多种图像格式
- **实时处理**: 提供图形化界面，支持实时图像处理和结果展示
- **详细分析**: 输出血管数量统计、占比分析等量化指标
- **结果导出**: 支持分割结果图像保存

### 技术特点
- **深度学习架构**: 基于UNet的编码器-解码器结构
- **高性能处理**: 支持GPU加速（CUDA）
- **用户友好**: 直观的PyQt图形界面
- **跨平台**: 支持Windows操作系统

## 🛠 系统要求

### 硬件要求
- **处理器**: Intel Core i5 或更高
- **内存**: 8GB RAM 或更高
- **显卡**: NVIDIA GPU（支持CUDA，可选）
- **存储空间**: 至少2GB可用空间

### 软件要求
- **操作系统**: Windows 10/11
- **Python版本**: 3.11+
- **深度学习框架**: PyTorch 2.5.1
- **图形界面**: PyQt5

## 📦 安装指南

### 1. 环境准备
```bash
# 创建虚拟环境
python -m venv .venv

# 激活虚拟环境（Windows）
.\venv\Scripts\activate

# 安装依赖包
pip install -r requirements.txt
pip install PyQt5
```

### 2. 数据准备
```bash
# 解压数据集
Expand-Archive -Path DRIVE.zip -DestinationPath .

# 数据预处理
python dataset.py
```

### 3. 模型训练（可选）
```bash
# 训练模型（如果尚未训练）
python train.py
```

## 🚀 使用指南

### 命令行模式
```bash
# 批量测试（生成结果图像）
python test.py

# 性能指标输出
# Jaccard: 0.5594 - F1: 0.7163 - Recall: 0.9114 - Precision: 0.5943 - Acc: 0.9618
# FPS: 4.33
```

### 图形界面模式
1. **启动应用程序**: 双击 `run_gui.bat` 或运行 `python gui_app.py`
2. **上传图像**: 点击"上传图像"按钮选择视网膜图像
3. **分割处理**: 点击"分割血管"按钮开始自动处理
4. **查看结果**: 在右侧面板查看分割结果和统计信息
5. **保存结果**: 点击"保存结果"导出分割图像

### 界面功能说明
- **原始图像面板**: 显示上传的视网膜原图
- **分割结果面板**: 显示绿色高亮的血管分割结果
- **统计信息区**: 显示血管数量、占比等量化数据
- **控制按钮**: 上传、分割、保存功能按钮
- **进度条**: 实时显示处理进度

## 📊 性能指标

### 模型评估结果
| 指标 | 数值 | 说明 |
|------|------|------|
| **Jaccard系数** | 0.5594 | 分割重叠度度量 |
| **F1分数** | 0.7163 | 精确率和召回率的调和平均 |
| **召回率** | 0.9114 | 真正例率，检测灵敏度 |
| **精确率** | 0.5943 | 阳性预测值 |
| **准确率** | 0.9618 | 总体分类准确度 |
| **处理速度** | 4.33 FPS | 每秒处理帧数 |

### 训练过程
- **训练周期**: 50个epoch
- **最终训练损失**: 0.221
- **最终验证损失**: 0.382
- **最佳验证损失**: 0.3818

## 🏗 系统架构

### 文件结构
```
Retinal-vessel-segmentation-main/
├── gui_app.py          # 图形界面主程序
├── run_gui.bat         # Windows启动脚本
├── model.py            # UNet模型定义
├── train.py            # 模型训练脚本
├── test.py             # 模型测试脚本
├── dataset.py          # 数据预处理
├── preprocess.py       # 数据加载器
├── loss.py             # 损失函数定义
├── utils.py            # 工具函数
├── requirements.txt    # 依赖包列表
├── files/
│   └── checkpoint.pth  # 训练好的模型权重
├── data/               # 处理后的数据集
├── results/            # 测试结果图像
└── DRIVE/              # 原始数据集
```

### 技术栈
- **深度学习框架**: PyTorch
- **图形界面**: PyQt5
- **图像处理**: OpenCV, Pillow
- **数据处理**: NumPy, Albumentations
- **进度显示**: tqdm

## 🔧 高级配置

### 自定义训练参数
在 `train.py` 中修改以下超参数：
```python
H = 512                 # 图像高度
W = 512                 # 图像宽度
batch_size = 2          # 批处理大小
num_epochs = 50         # 训练周期数
lr = 1e-4               # 学习率
```

### GPU加速配置
系统自动检测GPU可用性，如需强制使用CPU：
```python
device = torch.device('cpu')  # 修改为CPU模式
```

## 📝 实验报告

### 实验环境
- **操作系统**: Windows 11
- **Python版本**: 3.11.5
- **PyTorch版本**: 2.5.1+cu121
- **CUDA版本**: 11.8
- **硬件配置**: NVIDIA GTX 1060 6GB

### 数据集信息
- **数据集名称**: DRIVE (Digital Retinal Images for Vessel Extraction)
- **图像数量**: 40张视网膜图像（20训练 + 20测试）
- **图像格式**: 768×584像素，TIFF格式
- **标注信息**: 专业医师手动标注的血管掩码

### 实验结果分析

#### 1. 分割效果
模型在测试集上表现出色，特别是在召回率方面达到91.14%，说明模型能够有效检测出大部分血管结构。精确率相对较低（59.43%），表明存在一定的误检情况。

#### 2. 处理性能
- **训练时间**: 约25分钟（50个epoch）
- **推理速度**: 4.33 FPS（512×512分辨率）
- **内存占用**: 约2GB（训练时）

#### 3. 可视化结果
分割结果图像保存在 `results/` 目录下，每张图像包含：
- 原始视网膜图像
- 真实血管标注掩码
- 模型预测分割结果

### 局限性及改进方向

#### 当前局限性
1. **小血管检测**: 对细小血管的分割精度有待提高
2. **病变干扰**: 视网膜病变可能影响分割准确性
3. **计算资源**: 需要较高的GPU内存

#### 改进建议
1. **数据增强**: 增加更多样化的训练数据
2. **模型优化**: 尝试更先进的网络架构（如UNet++）
3. **后处理优化**: 加入形态学操作改善分割结果
4. **多尺度训练**: 采用多尺度输入提高小血管检测

